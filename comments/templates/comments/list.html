{% load comments %}
{% load comments_extras %}
{% load mptt_tags %}
{% load i18n %}
{% load static %}
{% get_comment_list for post as comment_list %}
<dl class="comment-list list-unstyled" id="comments">
    {% recursetree comment_list %}
    {% with node as comment %}
    <dt class="comment-item" id="c{{ comment.id }}">
        {% if user.socialaccount %}
        <img src="{{ user.socialaccount_set.all.0.get_avatar_url }}" />
        {% endif %}
        <span class="nickname">{{ comment.user.username }}</span>
        <time class="created_time" datetime="{{ comment.created_time }}">{{ comment.created_time|naturaltime }}</time>

        {% if comment.parent %}<span>{% trans "reply" %}" "{{ comment.parent }}</span>{% endif %}
        <div class="text">
            <div class="reply">
                <button id="reply-btn{{ comment.pk }}" onclick="showReply({{ comment.pk }});">
                    {% trans "reply" %}</button>
            </div>
            {{ comment.comment_html|safe }}
        </div>
        {# reply form #}
        <!--{% url 'comments:post_comments_reply' comment.pk %}-->
    </dt>

    {% if not comment.is_leaf_node %}
    <dl class="children" style="margin-left: 40px">
        {{ children }}
    </dl>
    {% endif %}

    {% endrecursetree %}
</dl>

<script type="text/javascript">
    function showReply(x) {
        const box = document.getElementById("c" + x);
        if (document.getElementById("iframe"+x)){
            return
        };
        const newiframe = document.createElement('iframe');
        newiframe.style.cssText = "class:reply-box;height:500;width:100%;frameborder:0;scrolling:0;";
        newiframe.id = "iframe"+x;
        newiframe.name = "reply_iframe";
        newiframe.src = "https://" + document.domain + "/zh-hans/comments/reply/" + x;
        box.appendChild(newiframe);
    }
</script>
{# FIXME: 点回复弹出md回复框 回复键位置调整 回复跳转为本页刷新并msg  #}